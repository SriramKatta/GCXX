set(LIB_INTERNAL_NAME gpu_cxx)

add_library(${LIB_INTERNAL_NAME} INTERFACE)
add_library(gpucxx::gpucxx ALIAS ${LIB_INTERNAL_NAME})
target_include_directories(${LIB_INTERNAL_NAME} INTERFACE include)
target_link_libraries(${LIB_INTERNAL_NAME} INTERFACE fmt::fmt)

if(GPUCXX_CUDA_MODE)
  set(CMAKE_CUDA_ARCHITECTURES 80)
  enable_language(CUDA)
  find_package(CUDAToolkit REQUIRED)
  target_compile_definitions(${LIB_INTERNAL_NAME} INTERFACE GPUCXX_CUDA_MODE)
  target_link_libraries(${LIB_INTERNAL_NAME} INTERFACE CUDA::cudart)
elseif(GPUCXX_HIP_MODE)
  enable_language(HIP)
  find_package(hip REQUIRED)
  target_compile_definitions(${LIB_INTERNAL_NAME} INTERFACE GPUCXX_HIP_MODE)
  target_compile_definitions(${LIB_INTERNAL_NAME} INTERFACE __HIP_PLATFORM_AMD__)
  target_link_libraries(${LIB_INTERNAL_NAME} INTERFACE hip::device)
  target_include_directories(${LIB_INTERNAL_NAME} INTERFACE ${HIP_INCLUDE_DIRS})
endif()
